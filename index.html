<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Governo MetroCity</title>
  <meta name="description" content="Sito istituzionale del Governo MetroCity" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --violet:#5B2B9D; /* header/footer */
      --violet-700:#4A2184;
      --bg:#ffffff; /* body */
      --box:#E9E9ED; /* card background */
      --text:#1b1b1f;
      --muted:#6b7280;
      --link:#3b82f6;
      --radius:16px;
      --shadow:0 10px 24px rgba(0,0,0,.08);
      --shadow-sm:0 6px 16px rgba(0,0,0,.06);
      --maxw:1100px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:"Titillium Web", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text); background:var(--bg);
      line-height:1.35; 
    }
    a{color:var(--link); text-decoration:none}
    a:hover{text-decoration:underline}

    /* Header */
    header{
      position:sticky; top:0; z-index:50;
      background:linear-gradient(180deg, var(--violet) 0%, var(--violet-700) 100%);
      color:#fff; box-shadow:var(--shadow);
    }
    .topbar{max-width:var(--maxw); margin:0 auto; padding:14px 20px; display:flex; gap:16px; align-items:center;}
    .brand{display:flex; flex-direction:column}
    .brand h1{margin:0; font-size:1.6rem; letter-spacing:.3px}
    .brand span{opacity:.9}

    nav{margin-left:auto; display:flex; align-items:center; gap:10px; flex-wrap:wrap}
    .menu{display:flex; gap:6px; flex-wrap:wrap}
    .menu a{color:#fff; padding:8px 12px; border-radius:999px; border:1px solid rgba(255,255,255,.2)}
    .menu a.active,.menu a:hover{background:rgba(255,255,255,.14)}

    /* Search */
    .search{position:relative}
    .search input{
      padding:10px 36px 10px 12px; border-radius:999px; border:none; outline:none; width:220px;
      box-shadow:var(--shadow-sm); background:rgba(255,255,255,.95); color:#111;
    }
    .search button{
      position:absolute; right:4px; top:50%; transform:translateY(-50%);
      border:none; background:transparent; color:#333; cursor:pointer; padding:6px 8px; border-radius:8px;
    }

    /* Visually hidden label */
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}

    /* Lang switch */
    .lang-switch{display:flex; gap:6px; align-items:center; margin-left:6px}
    .lang-switch button{background:rgba(255,255,255,.16); color:#fff; border:1px solid rgba(255,255,255,.25); padding:8px 10px; border-radius:10px; cursor:pointer}
    .lang-switch button.active{background:#fff; color:var(--violet-700)}

    /* Hero */
    .hero{background:
      radial-gradient(1200px 300px at 50% -120px, rgba(255,255,255,.18), transparent 60%),
      linear-gradient(0deg, #fafafa, #ffffff);
      border-bottom:1px solid #efeff4;
    }
    .hero-inner{max-width:var(--maxw); margin:0 auto; padding:28px 20px 6px}
    .breadcrumbs{color:var(--muted); font-size:.95rem}
    .hero h2{margin:8px 0 6px; font-size:2rem}
    .hero p{margin:0; color:#4b5563}

    /* Layout */
    main{max-width:var(--maxw); margin:0 auto; padding:22px 20px 56px}
    .grid{display:grid; grid-template-columns:repeat(12,1fr); gap:18px}
    .col-8{grid-column:span 8}
    .col-4{grid-column:span 4}
    .col-12{grid-column:span 12}

    /* Cards */
    .card{background:var(--box); border-radius:var(--radius); box-shadow:var(--shadow-sm); padding:18px}
    .card h3{margin:0 0 8px}
    .muted{color:var(--muted)}
    .btn{display:inline-block; padding:10px 14px; border-radius:12px; background:var(--violet); color:#fff; border:0; box-shadow:var(--shadow-sm)}
    .btn:hover{filter:brightness(1.05)}

    /* Sections visibility */
    section[data-route]{display:none}
    section[data-route].active{display:block}

    /* Lists */
    .list{display:grid; gap:12px}
    .ministeri{display:grid; grid-template-columns:repeat(auto-fill, minmax(240px,1fr)); gap:12px}
    .ministero{background:var(--box); border-radius:var(--radius); padding:14px; box-shadow:var(--shadow-sm)}
    .ministero h4{margin:2px 0 6px}

    /* Footer */
    footer{background:var(--violet-700); color:#f3f4f6; padding:18px 20px; margin-top:32px}
    .footer-inner{max-width:var(--maxw); margin:0 auto; display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between}
    .footer-inner a{color:#fff}

    /* Responsive */
    @media (max-width: 900px){
      .col-8{grid-column:span 12}
      .col-4{grid-column:span 12}
      nav{width:100%}
      .menu{flex:1 1 auto}
      .search input{width:100%}
    }
  </style>
</head>
<body>
  <header>
    <div class="topbar" role="navigation" aria-label="Barra superiore">
      <div class="brand" aria-label="Intestazione sito">
        <h1 id="site-title" data-i18n="site.title">Governo MetroCity</h1>
        <span data-i18n="site.subtitle">Presidenza del Consiglio dei Ministri</span>
      </div>

      <nav aria-label="Menu principale">
        <div class="menu" role="menubar">
          <a href="#/" role="menuitem" data-link data-i18n="nav.home" class="active">Home</a>
          <a href="#/presidente" role="menuitem" data-link data-i18n="nav.president">Presidente</a>
          <a href="#/governo" role="menuitem" data-link data-i18n="nav.government">Il Governo</a>
          <a href="#/feed" role="menuitem" data-link>Feed</a>
        </div>
      </nav>

      <div class="search" role="search">
        <label class="sr-only" for="q">Cerca</label>
        <input id="q" type="search" placeholder="Cerca..." data-i18n-placeholder="search.placeholder" />
        <button aria-label="Cerca" title="Cerca" id="searchBtn">üîé</button>
      </div>

      <div class="lang-switch" aria-label="Cambio lingua">
        <button id="itBtn" class="active" data-lang="it" aria-pressed="true">IT</button>
        <button id="enBtn" data-lang="en" aria-pressed="false">EN</button>
      </div>
    </div>
  </header>

  <div class="hero" aria-labelledby="hero-title">
    <div class="hero-inner">
      <div class="breadcrumbs" id="breadcrumbs">Home</div>
      <h2 id="hero-title" data-i18n="hero.title">Benvenuti nel portale istituzionale</h2>
      <p data-i18n="hero.lead">Informazioni ufficiali su Presidenza, Ministeri e attivit√† pubbliche della citt√†.</p>
    </div>
  </div>

  <main id="app" tabindex="-1">

    <!-- HOME -->
    <section data-route="home" class="active" aria-label="Home">
      <div class="grid">
        <div class="col-8">
          <article class="card" id="home-pres-preview">
            <h3 data-i18n="home.presidentPreview.title">Presidente del Consiglio dei Ministri</h3>
            <p class="muted" data-i18n="home.presidentPreview.lead">Conosci la visione e le priorit√† del Presidente del Consiglio, Marco Lorsi.</p>
            <p data-i18n="home.presidentPreview.text">Nominato a seguito delle consultazioni, il Presidente guida l'azione dell'Esecutivo, coordina i Ministri e rappresenta l'indirizzo politico generale del Governo.</p>
            <a class="btn" href="#/presidente" data-i18n="cta.readMore">Scopri di pi√π</a>
          </article>

          <article class="card" id="home-gov-preview">
            <h3 data-i18n="home.governmentPreview.title">Il Governo</h3>
            <p class="muted" data-i18n="home.governmentPreview.lead">Ministeri e funzioni principali.</p>
            <div class="ministeri" id="gov-preview-list"><!-- filled by JS --></div>
            <div style="margin-top:10px"><a class="btn" href="#/governo" data-i18n="cta.viewAll">Vedi tutti</a></div>
          </article>
        </div>

        <aside class="col-4">
          <section class="card" id="home-feed-preview">
            <h3>Feed</h3>
            <ul class="list" id="feed-preview-list"><!-- filled by JS --></ul>
            <a class="btn" href="#/feed" data-i18n="cta.openFeed">Apri feed</a>
          </section>
        </aside>
      </div>
    </section>

    <!-- PRESIDENTE -->
    <section data-route="presidente" aria-label="Presidente del Consiglio dei Ministri">
      <article class="card">
        <h3 data-i18n="president.title">Presidente del Consiglio dei Ministri</h3>
        <p class="muted" data-i18n="president.name">Marco Lorsi</p>
        <p data-i18n="president.story">
          Nato e cresciuto a MetroCity, Marco Lorsi ha maturato esperienza in amministrazione pubblica e coordinamento di progetti strategici per la citt√†. Dopo un periodo di consultazioni con le forze civiche e istituzionali, ha ricevuto l'incarico di formare il Governo. Le sue priorit√† includono modernizzazione amministrativa, sicurezza urbana, innovazione sostenibile e dialogo costante con i cittadini.
        </p>
        <p class="muted" data-i18n="president.note">Questa √® una breve biografia di riferimento; le informazioni ufficiali sono pubblicate nei comunicati e nelle note stampa del Consiglio.</p>
      </article>
    </section>

    <!-- GOVERNO -->
    <section data-route="governo" aria-label="Il Governo">
      <article class="card">
        <h3 data-i18n="government.title">Struttura del Governo</h3>
        <p class="muted" data-i18n="government.lead">Di seguito i ministeri principali.</p>
        <div class="ministeri" id="ministeri-list"><!-- filled by JS --></div>
      </article>
    </section>

    <!-- FEED -->
    <section data-route="feed" aria-label="Feed istituzionale">
      <article class="card">
        <h3>Feed</h3>
        <p class="muted" data-i18n="feed.lead">Aggiornamenti e avvisi alla cittadinanza.</p>
        <ul class="list" id="feed-list"><!-- filled by JS --></ul>
      </article>
    </section>

  </main>

  <footer>
    <div class="footer-inner">
      <div>
        <strong data-i18n="footer.gov">Governo MetroCity</strong> ‚Äî <span data-i18n="footer.rights">Tutti i diritti riservati.</span>
      </div>
      <div>
        <span data-i18n="footer.mainSite">Sito principale:</span> <a href="https://metrocity.life" rel="noopener" target="_blank">metrocity.life</a>
      </div>
    </div>
  </footer>

  <script>
    // Simple in-page i18n
    const I18N = {
      it: {
        'site.title':'Governo MetroCity',
        'site.subtitle':'Presidenza del Consiglio dei Ministri',
        'nav.home':'Home', 'nav.president':'Presidente', 'nav.government':'Il Governo',
        'search.placeholder':'Cerca...',
        'hero.title':'Benvenuti nel portale istituzionale',
        'hero.lead':'Informazioni ufficiali su Presidenza, Ministeri e attivit√† pubbliche della citt√†.',
        'home.presidentPreview.title':'Presidente del Consiglio dei Ministri',
        'home.presidentPreview.lead':'Conosci la visione e le priorit√† del Presidente del Consiglio, Marco Lorsi.',
        'home.presidentPreview.text':'Nominato a seguito delle consultazioni, il Presidente guida l\'azione dell\'Esecutivo, coordina i Ministri e rappresenta l\'indirizzo politico generale del Governo.',
        'home.governmentPreview.title':'Il Governo',
        'home.governmentPreview.lead':'Ministeri e funzioni principali.',
        'cta.readMore':'Scopri di pi√π', 'cta.viewAll':'Vedi tutti', 'cta.openFeed':'Apri feed',
        'president.title':'Presidente del Consiglio dei Ministri',
        'president.name':'Marco Lorsi',
        'president.story':'Nato e cresciuto a MetroCity, Marco Lorsi ha maturato esperienza in amministrazione pubblica e coordinamento di progetti strategici per la citt√†. Dopo un periodo di consultazioni con le forze civiche e istituzionali, ha ricevuto l\'incarico di formare il Governo. Le sue priorit√† includono modernizzazione amministrativa, sicurezza urbana, innovazione sostenibile e dialogo costante con i cittadini.',
        'president.note':'Questa √® una breve biografia di riferimento; le informazioni ufficiali sono pubblicate nei comunicati e nelle note stampa del Consiglio.',
        'government.title':'Struttura del Governo',
        'government.lead':'Di seguito i ministeri principali.',
        'feed.lead':'Aggiornamenti e avvisi alla cittadinanza.',
        'footer.gov':'Governo MetroCity',
        'footer.rights':'Tutti i diritti riservati.',
        'footer.mainSite':'Sito principale:'
      },
      en: {
        'site.title':'MetroCity Government',
        'site.subtitle':'Office of the Prime Minister',
        'nav.home':'Home', 'nav.president':'Prime Minister', 'nav.government':'The Cabinet',
        'search.placeholder':'Search...',
        'hero.title':'Welcome to the official portal',
        'hero.lead':'Official information on the Office of the Prime Minister, Ministries, and public activities.',
        'home.presidentPreview.title':'Prime Minister',
        'home.presidentPreview.lead':'Learn about the vision and priorities of Prime Minister Marco Lorsi.',
        'home.presidentPreview.text':'Appointed after consultations, the Prime Minister leads the Executive, coordinates Ministers, and sets the Government\'s general policy direction.',
        'home.governmentPreview.title':'The Cabinet',
        'home.governmentPreview.lead':'Main ministries and functions.',
        'cta.readMore':'Read more', 'cta.viewAll':'View all', 'cta.openFeed':'Open feed',
        'president.title':'Prime Minister',
        'president.name':'Marco Lorsi',
        'president.story':'Born and raised in MetroCity, Marco Lorsi gained experience in public administration and the coordination of strategic projects for the city. After consultations with civic and institutional forces, he was tasked with forming the Government. His priorities include administrative modernization, urban security, sustainable innovation, and ongoing dialogue with citizens.',
        'president.note':'This is a short reference biography; official details are published in Council press notes.',
        'government.title':'Government Structure',
        'government.lead':'Below are the principal ministries.',
        'feed.lead':'Updates and notices to the public.',
        'footer.gov':'MetroCity Government',
        'footer.rights':'All rights reserved.',
        'footer.mainSite':'Main site:'
      }
    };

    const MINISTERI = [
      { key:'interno', it:'Ministero dell\'Interno', en:'Ministry of the Interior' },
      { key:'esteri', it:'Ministero degli Affari Esteri', en:'Ministry of Foreign Affairs' },
      { key:'mef', it:'Ministero dell\'Economia e delle Finanze', en:'Ministry of Economy and Finance' },
      { key:'difesa', it:'Ministero della Difesa', en:'Ministry of Defence' },
      { key:'giustizia', it:'Ministero della Giustizia', en:'Ministry of Justice' },
      { key:'istruzione', it:'Ministero dell\'Istruzione e del Merito', en:'Ministry of Education and Merit' },
      { key:'salute', it:'Ministero della Salute', en:'Ministry of Health' },
      { key:'infrastrutture', it:'Ministero delle Infrastrutture e dei Trasporti', en:'Ministry of Infrastructure and Transport' },
      { key:'ambiente', it:'Ministero dell\'Ambiente e della Sicurezza Energetica', en:'Ministry for the Environment and Energy Security' }
    ];

    const FEED = [
      { date:'2025-08-02', it:{title:'Apertura Settimana della Mobilit√†', text:'Presentate nuove linee guida per la viabilit√† sostenibile.'}, en:{title:'Mobility Week Opening', text:'New guidelines for sustainable mobility presented.'}},
      { date:'2025-07-24', it:{title:'Avviso di Protezione Civile', text:'Interventi programmati su rete idrica: possibili disservizi.'}, en:{title:'Civil Protection Notice', text:'Scheduled works on water network: possible service interruptions.'}},
      { date:'2025-07-10', it:{title:'Incontro con le Associazioni', text:'Tavolo di confronto su sicurezza urbana e spazi pubblici.'}, en:{title:'Meeting with Associations', text:'Roundtable on urban safety and public spaces.'}}
    ];

    // Safe query helpers (avoid global "$$" name clashes)
    const $ = (sel, root=document) => root.querySelector(sel);
    const qsa = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    const routes = {
      '': 'home',
      '/': 'home',
      '/presidente':'presidente',
      '/governo':'governo',
      '/feed':'feed'
    };

    let lang = 'it';

    function setLang(newLang){
      lang = newLang;
      // toggle buttons
      $('#itBtn').classList.toggle('active', lang==='it');
      $('#enBtn').classList.toggle('active', lang==='en');
      $('#itBtn').setAttribute('aria-pressed', lang==='it');
      $('#enBtn').setAttribute('aria-pressed', lang==='en');
      // apply translations
      qsa('[data-i18n]').forEach(el=>{
        const key = el.getAttribute('data-i18n');
        const txt = I18N[lang]?.[key];
        if(typeof txt === 'string') el.textContent = txt;
      });
      qsa('[data-i18n-placeholder]').forEach(el=>{
        const key = el.getAttribute('data-i18n-placeholder');
        const txt = I18N[lang]?.[key];
        if(typeof txt === 'string') el.setAttribute('placeholder', txt);
      });
      // re-render dynamic blocks (ministries & feed)
      renderMinistries();
      renderFeed();
      renderHomePreviews();
    }

    function renderMinistries(){
      const container = $('#ministeri-list');
      if(!container) return;
      container.innerHTML = '';
      MINISTERI.forEach(m => {
        const div = document.createElement('div');
        div.className='ministero';
        const title = (lang==='it'?m.it:m.en);
        div.innerHTML = `<h4>${title}</h4><p class="muted">${lang==='it'?'Titolare:':''} <em>${lang==='it'?'In carica':'Incumbent'}</em></p>`;
        container.appendChild(div);
      });
    }

    function renderHomePreviews(){
      const preview = $('#gov-preview-list');
      if(!preview) return;
      preview.innerHTML = '';
      MINISTERI.slice(0,4).forEach(m=>{
        const card = document.createElement('div');
        card.className='ministero';
        card.innerHTML = `<h4>${lang==='it'?m.it:m.en}</h4><p class="muted">${lang==='it'?'Sintesi delle competenze.':'Summary of remit.'}</p>`;
        preview.appendChild(card);
      });

      const feedBox = $('#feed-preview-list');
      if(feedBox){
        feedBox.innerHTML = '';
        FEED.slice(0,3).forEach(item => {
          const li = document.createElement('li');
          const t = lang==='it'?item.it.title:item.en.title;
          const d = new Date(item.date).toLocaleDateString(lang==='it'?'it-IT':'en-GB');
          li.innerHTML = `<strong>${d}</strong> ‚Äî ${t}`;
          feedBox.appendChild(li);
        });
      }
    }

    function renderFeed(filter=''){
      const list = $('#feed-list');
      if(!list) return;
      list.innerHTML = '';
      FEED.filter(item=>{
        const t = (lang==='it'?item.it.title:item.en.title).toLowerCase();
        const x = (lang==='it'?item.it.text:item.en.text).toLowerCase();
        return t.includes(filter) || x.includes(filter);
      }).forEach(item=>{
        const li = document.createElement('li');
        const dateStr = new Date(item.date).toLocaleDateString(lang==='it'?'it-IT':'en-GB');
        const t = lang==='it'?item.it.title:item.en.title;
        const x = lang==='it'?item.it.text:item.en.text;
        li.className='card';
        li.innerHTML = `<div><strong>${dateStr}</strong> ‚Äî ${t}</div><div class="muted">${x}</div>`;
        list.appendChild(li);
      })
    }

    function setActiveRoute(){
      const hash = location.hash.replace('#','');
      const route = routes[hash] || 'home';
      // Update active section
      qsa('section[data-route]').forEach(s=>s.classList.remove('active'));
      $(`section[data-route="${route}"]`)?.classList.add('active');
      // Update menu active state
      qsa('a[data-link]').forEach(a=>{
        const wanted = a.getAttribute('href').replace('#','');
        a.classList.toggle('active', wanted===hash || (route==='home' && wanted==="#/"));
      });
      // Update hero/breadcrumbs
      const map = {home:'Home', presidente: (lang==='it'?'Presidente':'Prime Minister'), governo:(lang==='it'?'Il Governo':'The Cabinet'), feed:'Feed'};
      $('#breadcrumbs').textContent = map[route] || 'Home';
      $('#hero-title').textContent = route==='home' ? (I18N[lang]['hero.title']) : map[route];
      // Focus main for accessibility
      $('#app').focus({preventScroll:true});
    }

    // Search logic (filters current route content where applicable)
    function performSearch(){
      const q = $('#q').value.trim().toLowerCase();
      const route = ($('section.active')?.getAttribute('data-route')) || 'home';
      if(route==='feed'){
        renderFeed(q);
      } else if(route==='governo'){
        // filter ministries
        const list = $('#ministeri-list');
        qsa('.ministero', list).forEach(card=>{
          const show = card.textContent.toLowerCase().includes(q);
          card.style.display = show? 'block' : 'none';
        })
      } else {
        // on home, filter both previews
        const homeCards = ['#home-pres-preview', '#home-gov-preview', '#home-feed-preview'].map(sel=>$(sel));
        homeCards.forEach(card=>{
          if(!card) return;
          card.style.display = q? (card.textContent.toLowerCase().includes(q) ? 'block':'none') : 'block';
        })
      }
    }

    // --- Minimal Self Tests (run in console) ---
    function runSelfTests(){
      const results = [];
      try {
        // helper existence
        results.push({name:'qsa helper exists', pass: typeof qsa === 'function'});
        results.push({name:'$ helper exists', pass: typeof $ === 'function'});
        // i18n switch applies title & placeholder
        const prevTitle = $('#site-title').textContent;
        setLang('en');
        const enOK = $('#site-title').textContent === I18N.en['site.title'] && $('#q').getAttribute('placeholder') === I18N.en['search.placeholder'];
        setLang('it');
        const itOK = $('#site-title').textContent === I18N.it['site.title'] && $('#q').getAttribute('placeholder') === I18N.it['search.placeholder'];
        results.push({name:'Language switch updates UI', pass: enOK && itOK});
        // routing
        const oldHash = location.hash;
        location.hash = '#/governo';
        setActiveRoute();
        const govActive = document.querySelector('section[data-route="governo"]').classList.contains('active');
        location.hash = oldHash || '#/';
        setActiveRoute();
        results.push({name:'Routing activates correct section', pass: govActive});
        // search does not throw
        $('#q').value = 'health';
        performSearch();
        results.push({name:'Search executes', pass: true});
      } catch (e) {
        results.push({name:'Unexpected error during tests', pass:false, error: String(e)});
      }
      console.table(results);
      return results.every(r=>r.pass);
    }

    // Init
    window.addEventListener('hashchange', setActiveRoute);
    document.addEventListener('DOMContentLoaded', () => {
      // wire language switch
      $('#itBtn').addEventListener('click', ()=> setLang('it'));
      $('#enBtn').addEventListener('click', ()=> setLang('en'));
      // search
      $('#searchBtn').addEventListener('click', performSearch);
      $('#q').addEventListener('keydown', (e)=>{ if(e.key==='Enter') performSearch();});
      // first render
      setLang('it');
      renderMinistries();
      renderHomePreviews();
      renderFeed();
      setActiveRoute();
      // run minimal tests (see console)
      setTimeout(runSelfTests, 0);
    });
  </script>
</body>
</html>
